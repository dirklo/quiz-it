<div class="container">
    <h1 class="edit_quiz_title">Edit Quiz</h1>
    <div>
        <form action="/quizzes/<%= @quiz.id %>" method="POST">
            <input type="hidden" id="hidden" name="_method" value="PATCH">
            <div id="quiz_setup_div">
                <h2>Quiz Setup</h2>
                <div>
                    <label for="quiz_name">Quiz Name:</label>
                    <input type="text" id="quiz_name" name="quiz[name]" value="<%= @quiz.name %>">   
                </div>
                <br>
                <div>
                    <label for="quiz_description">Quiz Description:</label>
                    <textarea id="quiz_description" name="quiz[description]"><%= @quiz.description %></textarea>
                </div>
                <br>
                <div>   
                    <label for="quiz_category">Select a Category:</label>
                    <select id="quiz_category" name="quiz[category]">
                        <% @categories.each do |category|%>
                            <option value="<%= category.id %>" <%= 'selected' if category.id == @quiz.category_id %>><%= category.name %></option>
                        <% end %>
                    </select>
                </div>
                <div>
                    <input type="checkbox" id="quiz_public" name="quiz[public]" value="true" <%= 'checked' if @quiz.public == true %>> 
                    <label for="quiz_public">Public Quiz</label>  
                </div>
                <% if @quiz.is_author?(current_user.email) %>
                    <form action="/quizzes/<%= @quiz.id %>/access">
                        <input type="submit" class="edit_user_access_button" value="Edit User Access">
                    </form>
                <% end %>
            </div>
            <br>
            
            <br>
            <section id="questions_container">
                <% @quiz.questions.each do |question| %>
                    <article id="q<%= question.order %>" class="question_article">
                        <div class="question_title_div">
                            <h2>Question <%= question.order %>:</h2>
                            <% if question.order > 1 %>
                                <div>
                                    <button type="button" id="q<%= question.order %>_delete_button" class="question_delete_button" onclick="deleteAndRenumberQuestions(<%= question.order %>)">X</button>
                                </div>
                            <% end %>
                        </div>
                        <div>
                            <label for="q<%= question.order %>_kind" class="question_kind_label">Question Type:</label>
                            <select id="q<%= question.order %>_kind" class="question_kind_input" name="questions[][kind]" value="<%= question.kind %>">
                                <option value="mc_many" <%= 'selected' if question.kind == 'mc_many' %>>Multiple Choice: Many Correct Answers</option>
                                <option value="mc_one" <%= 'selected' if question.kind == 'mc_one' %>>Multiple Choice: One Correct Answer</option>
                            </select>
                        </div>
                        <br>
                        <div>
                            <label for="q<%= question.order %>_content" class="question_content_label">Question:</label>
                            <input type="text" id="q<%= question.order %>_content" class="question_content_input" name="questions[][content]" value="<%= question.content %>">
                        </div>
                        <br>
                        <div id="q<%= question.order %>_answers" class="answers_container">
                            <% question.answers.each_with_index do |answer, index| %>
                                <div id="q<%= question.order %>_a<%= index + 1 %>" class="answer_div">
                                    <div class="answer_title_div">
                                    <h3>Answer <%= index + 1 %>:</h3>
                                    <% if index > 0 %>
                                        <div>
                                            <button type="button" id="q<%= question.order %>_a<%= index + 1 %>_delete_button" class="answer_delete_button" onclick="deleteAnswer(<%= question.order %>, <%= index + 1 %>)">X</button>
                                        </div>
                                    <% end %>
                                    </div>
                                    <div>
                                        <input type="text" id="q<%= question.order %>_a<%= index + 1 %>_content" class="answer_content_input" name="questions[][answers][][content]" value="<%= answer.content %>">
                                    </div>
                                    <br>
                                    <div>
                                        <label for="q<%= question.order %>_a<%= index + 1 %>_correct" class="answer_correct_label">Correct Answer?</label>
                                        <input type="checkbox" id="q<%= question.order %>_a<%= index + 1 %>_correct" class="answer_correct_input" name="questions[][answers][][correct]" value="true" <%= 'checked' if answer.correct == true %>>
                                    </div>
                                </div>
                            <% end %>
                        </div>  
                        <div>
                            <button type="button" id="q<%= question.order %>_add_answer" class="add_answer_button"onclick="addAnswer(<%= question.order %>)">Add Answer</button>
                        </div>
                        <br>
                        <div>
                            <label for="q<%= question.order %>_limit" class="question_limit_label">Answer Limit:</label>
                            <input type="number" id="q<%= question.order %>_limit" class="question_limit_input" name="questions[][limit]" value="<%= question.limit || question.answers.length %>" max="<%= question.answers.length %>" min="1">
                        </div>
                    </article>
                <% end %>
            </section>
            <div class="new_quiz_controls">
                <div>
                    <button type="button" id="add_question" onclick="addQuestion()">Add Question</button>
                </div>
                <br>
                <input type="submit" value="Update Quiz">
            </div>
        </form>
    </div>
    <div class="return_div">
        <form action="/users/<%= current_user.id %>" method="GET">
            <button>Cancel and Exit</button>
        </form>
    </div>
</div>


<script type="text/javascript" src="/javascripts/createandedit.js"></script>